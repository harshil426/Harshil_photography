<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Collection of Harshil</title>
  <meta name="description" content="Collection of Harshil — daily photo collection.">
  <style>
    :root{
      --bg:#fafafa; --card:#fff; --muted:#6b7280; --accent:#0ea5a4;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,sans-serif;background:var(--bg);color:#111827;}
    header{padding:20px;display:flex;justify-content:space-between;align-items:center;max-width:1100px;margin:0 auto;}
    .brand{display:flex;gap:14px;align-items:center;}
    .logo{width:50px;height:50px;border-radius:10px;background:linear-gradient(135deg,#06b6d4,#7c3aed);color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;}
    h1{margin:0;font-size:20px}
    .tagline{color:var(--muted);font-size:13px}
    nav .social{display:flex;gap:10px;align-items:center}
    a.btn{padding:7px 12px;border-radius:8px;text-decoration:none;color:inherit;font-size:13px;border:1px solid rgba(0,0,0,0.06);}
    a.ig{display:inline-flex;gap:8px;align-items:center;padding:7px 12px;background:linear-gradient(90deg,#f97316,#ef4444);color:white;border:none;}
    main{max-width:1100px;margin:18px auto;padding:0 20px 80px}
    .hero{display:flex;gap:20px;align-items:center;justify-content:space-between;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06);}
    .hero-left{max-width:60%}
    .hero p{margin:10px 0 0;color:var(--muted)}
    .upload-box{display:flex;gap:12px;align-items:center;margin-top:12px}
    .upload-box input[type=file]{display:none}
    .upload-label{cursor:pointer;border:1px dashed rgba(0,0,0,0.08);padding:10px 12px;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfbfb);font-size:13px}
    .gallery{margin-top:18px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;position:relative;box-shadow:0 8px 20px rgba(2,6,23,0.06);}
    .card img{width:100%;display:block;height:220px;object-fit:cover}
    .meta{padding:10px;display:flex;gap:8px;align-items:center;justify-content:space-between}
    .meta .left{display:flex;gap:10px;align-items:center}
    .meta .title{font-weight:600;font-size:14px}
    .meta .muted{font-size:12px;color:var(--muted)}
    .actions{display:flex;gap:8px;align-items:center}
    .like-btn, .comment-btn{display:inline-flex;gap:8px;align-items:center;padding:7px 9px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;cursor:pointer;font-size:13px}
    .like-count{font-weight:700}
    .comments{padding:10px 12px;border-top:1px dashed rgba(0,0,0,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.6), transparent)}
    .comment{padding:8px 6px;border-radius:8px;background:rgba(15,23,42,0.02);margin-bottom:8px;font-size:13px}
    .comment small{color:var(--muted);display:block;font-size:11px;margin-top:4px}
    .review{margin-top:20px;padding:14px;border-radius:12px;background:linear-gradient(180deg,#fff,#fcfcfc);box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    .review textarea{width:100%;min-height:80px;border-radius:8px;padding:10px;border:1px solid rgba(0,0,0,0.06)}
    .row{display:flex;gap:10px}
    .muted-small{font-size:12px;color:var(--muted)}
    footer{max-width:1100px;margin:28px auto;padding:18px 20px;color:var(--muted);font-size:13px;}
    @media (max-width:720px){.hero{flex-direction:column;align-items:flex-start}.hero-left{max-width:100%}.brand h1{font-size:16px}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">CH</div>
      <div>
        <h1>Collection of Harshil</h1>
        <div class="tagline">Capturing moments, one click at a time.</div>
      </div>
    </div>
    <nav>
      <div class="social">
        <a class="ig" id="igLink" href="https://www.instagram.com/harshil.solanki9411?igsh=MTdtbW1xNTExNDJhcA%3D%3D&utm_source=qr" target="_blank" rel="noopener noreferrer">Instagram</a>
        <a class="btn" href="#gallery">Gallery</a>
        <a class="btn" href="#contact">Contact</a>
      </div>
    </nav>
  </header>
  <main>
    <section class="hero">
      <div class="hero-left">
        <h2>Welcome — Collection of Harshil</h2>
        <p>Daily photos, curated by you. Upload images below to share with all visitors.</p>
        <div class="upload-box">
          <label class="upload-label" for="fileInput">Add photos</label>
          <input type="file" id="fileInput" accept="image/*" multiple />
        </div>
      </div>
    </section>
    <section id="gallery" class="gallery"></section>
    <section class="review" id="contact">
      <h3>Visitor Reviews</h3>
      <input id="reviewName" placeholder="Your name" style="padding:8px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); width:100%; margin-bottom:8px" />
      <textarea id="reviewText" placeholder="Write a short review..."></textarea>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
        <button id="saveReview" class="btn">Submit Review</button>
      </div>
      <div id="reviewsList" style="margin-top:12px"></div>
    </section>
    <footer>
      © Collection of Harshil — built with Supabase integration.
    </footer>
  </main>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
  <script>
    const supabaseUrl = "https://kemjggajatytsuqdgrxi.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlbWpnZ2FqYXR5dHN1cWRncnhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0OTAxMDYsImV4cCI6MjA3MjA2NjEwNn0.v-5AuFAC9Ag4Xb7_9yESQw5onLh_TneLmZKDdRmOL9U";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const galleryEl = document.querySelector('.gallery');

    async function loadGallery() {
      const { data: photos, error } = await supabase.from('photos').select('*').order('created_at',{ascending:false});
      if(error){ console.error(error); return; }
      galleryEl.innerHTML = '';
      for(const photo of photos){
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${photo.url}" alt="${photo.title}" />
          <div class="meta">
            <div class="left">
              <div class="title">${photo.title || 'Untitled'}</div>
              <div class="muted">${new Date(photo.created_at).toLocaleString()}</div>
            </div>
            <div class="actions">
              <button class="like-btn" data-id="${photo.id}">❤ <span class="like-count">${photo.likes_count}</span></button>
              <button class="comment-btn" data-id="${photo.id}">Comments</button>
            </div>
          </div>
          <div class="comments" data-for="${photo.id}"></div>
        `;
        galleryEl.appendChild(card);
      }
      attachLikeCommentHandlers();
      loadAllComments();
    }

    async function attachLikeCommentHandlers(){
      document.querySelectorAll('.like-btn').forEach(btn=>{
        btn.onclick = async ()=>{
          const photoId = btn.dataset.id;
          const { data, error } = await supabase.rpc('increment_like', { photo_id: photoId });
          if(error){ console.error(error); return; }
          btn.querySelector('.like-count').textContent = data[0].likes_count;
        };
      });
      document.querySelectorAll('.comment-btn').forEach(btn=>{
        btn.onclick = async ()=>{
          const photoId = btn.dataset.id;
          document.querySelector(`.comments[data-for="${photoId}"]`).scrollIntoView({behavior:'smooth',block:'center'});
        };
      });
    }

    async function loadAllComments(){
      const { data: comments, error } = await supabase.from('comments').select('*').order('created_at',{ascending:false});
      if(error){ console.error(error); return; }
      comments.forEach(c=>{
        const container = document.querySelector(`.comments[data-for="${c.photo_id}"]`);
        if(container){
          const div = document.createElement('div');
          div.className='comment';
          div.innerHTML=`<strong>${c.name}</strong><div>${c.text}</div><small>${new Date(c.created_at).toLocaleString()}</small>`;
          container.appendChild(div);
        }
      });
    }

    // Upload photos
    const fileInput = document.getElementById('fileInput');
    fileInput.addEventListener('change', async e=>{
      const files = Array.from(e.target.files);
      for(const file of files){
        const fileName = Date.now() + '_' + file.name;
        const { data, error } = await supabase.storage.from('photos').upload(fileName,file,{upsert:true});
        if(error){ console.error(error); continue; }
        const { publicUrl } = supabase.storage.from('photos').getPublicUrl(fileName);
        await supabase.from('photos').insert([{ title:file.name, url:publicUrl }]);
      }
      loadGallery();
      fileInput.value='';
    });

    // Submit reviews
    document.getElementById('saveReview').onclick = async ()=>{
      const name = document.getElementById('reviewName').value || 'Anonymous';
      const text = document.getElementById('reviewText').value;
      if(!text){ alert('Type a review first'); return; }
      await supabase.from('reviews').insert([{name,text}]);
      document.getElementById('reviewName').value='';
      document.getElementById('reviewText').value='';
      loadReviews();
    }

    async function loadReviews(){
      const { data: reviews, error } = await supabase.from('reviews').select('*').order('created_at',{ascending:false});
      if(error){ console.error(error); return; }
      const container = document.getElementById('reviewsList');
      container.innerHTML='';
      reviews.forEach(r=>{
        const div = document.createElement('div');
        div.className='comment';
        div.innerHTML=`<strong>${r.name}</strong><div>${r.text}</div><small>${new Date(r.created_at).toLocaleString()}</small>`;
        container.appendChild(div);
      });
    }

    loadGallery();
    loadReviews();
  </script>
</body>
</html>